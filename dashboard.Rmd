---
title: "Dashboard"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: fill
    navbar:
      - { title: "Home", href: "index.html", align: right }
runtime: shiny

---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(shiny)

# Read data

walkability = read_csv("./data/merge_final.csv") 

walkability_clean = walkability %>% 
  separate(name, c("census_tract", "county", "state"), sep = ", ") %>% 
  drop_na(state)
  

#rmarkdown::render("dashboard.Rmd", output_format = "flexdashboard::flex_dashboard")

```

Column {.sidebar}
-----------------------------------------------------------------------

```{r}

state = walkability_clean %>% distinct(state) %>% drop_na()

selectInput(
  inputId = "state_choice",
  label = h3("State"),
  choices = state
)




selectInput(
  inputId = "demo_choice",
  label = h3("Demographic indicator"), 
  choices = c("age", "sex", "race/ethnicity", "median Household Income")
) 

radioButtons(
  inputId = "outcome_choice",
  label = h3("Health outcome"),
  choices = c("Physical health", "Physical activity", "Cholesterol", "Blood pressure", "Mental health")
)

```

Column {data-width=500}
-----------------------------------------------------------------------

### Demography

```{r}

# renderPrint({
#   input$state_choice
# })

# renderPlotly(
# walkability_clean %>%
#   filter(state == input[["location_choice"]]) %>% 
#   plot_ly(x = ~county, y = ~nat_walk_ind,
#           type = "bar", mode = "markers", alpha = 0.5)
# )

renderPlotly(
walkability_clean %>% 
  filter(!is.na(state) &
         state == input[["state_choice"]] &
         !is.na(nat_walk_ind)
         ) %>% 
  group_by(county) %>% 
  summarise(walk = mean(nat_walk_ind)) %>% 
  mutate(walkability <- NA,
         walkability[walk>= 15.26] <- "Most walkable",
         walkability[walk >= 10.51 & walk<= 15.25] <- "Above average walkable",
         walkability[walk >= 5.76 & walk<= 10.5] <- "Below average walkable",
         walkability[walk <= 5.75] <- "Least walkable",
         walkability = factor(walkability,
                              levels = c("Least walkable",
                                         "Below average walkable",
                                         "Above average walkable",
                                         "Most walkable"),
                              ordered = TRUE)
         ) %>%
  plot_ly(x = ~fct_reorder(county, walk), y = ~walk, color = ~walkability,
          type = "bar") %>% 
   layout(legend = list(x = 0.1, y = 0.9),
          yaxis = list(title = 'Average walkability index (0-20)'),
          xaxis = list(title = 'County'))
)

```



```{r}

```


Column {data-width=500}
-----------------------------------------------------------------------

### Health outcome

```{r}
renderPrint({
  input[["outcome_choice"]]
})


```


